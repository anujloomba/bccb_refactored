window.cricketStatsData = {
  "player_data": [
    {"Player_ID": "P001", "Name": "Anuj", "Bowling_Style": "Fast", "Batting_Style": "Reliable", "Is_Star": true, "Last_Updated": "2025-09-03", "Last_Edit_Date": "2025-09-03"},
    {"Player_ID": "P002", "Name": "Anil", "Bowling_Style": "Fast", "Batting_Style": "Reliable", "Is_Star": false, "Last_Updated": "2025-09-03", "Last_Edit_Date": "2025-09-03"},
    {"Player_ID": "P003", "Name": "Vivek", "Bowling_Style": "Medium", "Batting_Style": "So-So", "Is_Star": false, "Last_Updated": "2025-09-03", "Last_Edit_Date": "2025-09-03"},
    {"Player_ID": "P004", "Name": "Kiran", "Bowling_Style": "DNB", "Batting_Style": "Tailend", "Is_Star": false, "Last_Updated": "2025-09-03", "Last_Edit_Date": "2025-09-03"},
    {"Player_ID": "P005", "Name": "Ravi", "Bowling_Style": "Medium", "Batting_Style": "So-So", "Is_Star": false, "Last_Updated": "2025-09-03", "Last_Edit_Date": "2025-09-03"},
    {"Player_ID": "P006", "Name": "Chiru", "Bowling_Style": "Fast", "Batting_Style": "Reliable", "Is_Star": true, "Last_Updated": "2025-09-03", "Last_Edit_Date": "2025-09-03"},
    {"Player_ID": "P007", "Name": "Aditya", "Bowling_Style": "Medium", "Batting_Style": "So-So", "Is_Star": false, "Last_Updated": "2025-09-03", "Last_Edit_Date": "2025-09-03"},
    {"Player_ID": "P008", "Name": "Umesh", "Bowling_Style": "DNB", "Batting_Style": "Tailend", "Is_Star": false, "Last_Updated": "2025-09-03", "Last_Edit_Date": "2025-09-03"},
    {"Player_ID": "P009", "Name": "Sriram", "Bowling_Style": "Fast", "Batting_Style": "Reliable", "Is_Star": true, "Last_Updated": "2025-09-03", "Last_Edit_Date": "2025-09-03"},
    {"Player_ID": "P010", "Name": "Naveen", "Bowling_Style": "Medium", "Batting_Style": "So-So", "Is_Star": false, "Last_Updated": "2025-09-03", "Last_Edit_Date": "2025-09-03"}
  ],
  "match_data": [
    {
      "Match_ID": "M001",
      "Date": "2025-08-15",
      "Team1": "Thunderbolts",
      "Team2": "Lightning",
      "Team1_Captain": "P001",
      "Team2_Captain": "P002",
      "Team1_Composition": ["P001", "P002", "P003", "P004", "P005"],
      "Team2_Composition": ["P006", "P007", "P008", "P009", "P010"],
      "Winning_Team": "Thunderbolts",
      "Losing_Team": "Lightning",
      "Game_Start_Time": "2025-08-15T14:00:00Z",
      "Game_Finish_Time": "2025-08-15T17:30:00Z",
      "Winning_Team_Score": "145/6",
      "Losing_Team_Score": "120/8",
      "Result": "Thunderbolts won by 25 runs",
      "Overs": 20,
      "Man_Of_The_Match": "P001"
    },
    {
      "Match_ID": "M002",
      "Date": "2025-08-22",
      "Team1": "Eagles",
      "Team2": "Hawks",
      "Team1_Captain": "P003",
      "Team2_Captain": "P007",
      "Team1_Composition": ["P003", "P004", "P005", "P001", "P002"],
      "Team2_Composition": ["P006", "P007", "P008", "P009", "P010"],
      "Winning_Team": "Hawks",
      "Losing_Team": "Eagles",
      "Game_Start_Time": "2025-08-22T14:00:00Z",
      "Game_Finish_Time": "2025-08-22T17:15:00Z",
      "Winning_Team_Score": "129/3",
      "Losing_Team_Score": "128/9",
      "Result": "Hawks won by 7 wickets",
      "Overs": 20,
      "Man_Of_The_Match": "P007"
    },
    {
      "Match_ID": "M003",
      "Date": "2025-08-29",
      "Team1": "Thunderbolts",
      "Team2": "Eagles",
      "Team1_Captain": "P001",
      "Team2_Captain": "P003",
      "Team1_Composition": ["P001", "P002", "P003", "P004", "P005"],
      "Team2_Composition": ["P006", "P007", "P008", "P009", "P010"],
      "Winning_Team": "Eagles",
      "Losing_Team": "Thunderbolts",
      "Game_Start_Time": "2025-08-29T14:00:00Z",
      "Game_Finish_Time": "2025-08-29T17:25:00Z",
      "Winning_Team_Score": "152/7",
      "Losing_Team_Score": "137/8",
      "Result": "Eagles won by 15 runs",
      "Overs": 20,
      "Man_Of_The_Match": "P003"
    }
  ],
  "performance_data": [
    {"Match_ID": "M001", "Player_ID": "P001", "notOuts": 1, "runs": 50, "ballsFaced": 35, "fours": 6, "sixes": 2, "ballsBowled": 24, "runsConceded": 20, "wickets": 2, "extras": 0, "maidenOvers": 0, "isOut": false, "dismissalType": null, "dismissalBowler": null, "dismissalFielder": null},
    {"Match_ID": "M001", "Player_ID": "P002", "notOuts": 0, "runs": 10, "ballsFaced": 15, "fours": 1, "sixes": 0, "ballsBowled": 24, "runsConceded": 30, "wickets": 1, "extras": 2, "maidenOvers": 0, "isOut": true, "dismissalType": "bowled", "dismissalBowler": "P001", "dismissalFielder": null},
    {"Match_ID": "M001", "Player_ID": "P003", "notOuts": 0, "runs": 20, "ballsFaced": 18, "fours": 2, "sixes": 1, "ballsBowled": 12, "runsConceded": 10, "wickets": 0, "extras": 1, "maidenOvers": 0, "isOut": true, "dismissalType": "caught", "dismissalBowler": "P002", "dismissalFielder": "P004"},
    {"Match_ID": "M002", "Player_ID": "P003", "notOuts": 1, "runs": 45, "ballsFaced": 30, "fours": 5, "sixes": 1, "ballsBowled": 18, "runsConceded": 15, "wickets": 1, "extras": 0, "maidenOvers": 0, "isOut": false, "dismissalType": null, "dismissalBowler": null, "dismissalFielder": null},
    {"Match_ID": "M002", "Player_ID": "P007", "notOuts": 0, "runs": 60, "ballsFaced": 40, "fours": 7, "sixes": 2, "ballsBowled": 24, "runsConceded": 22, "wickets": 2, "extras": 1, "maidenOvers": 0, "isOut": true, "dismissalType": "lbw", "dismissalBowler": "P003", "dismissalFielder": null},
    {"Match_ID": "M002", "Player_ID": "P004", "notOuts": 0, "runs": 5, "ballsFaced": 10, "fours": 0, "sixes": 0, "ballsBowled": 6, "runsConceded": 8, "wickets": 0, "extras": 0, "maidenOvers": 0, "isOut": true, "dismissalType": "run out", "dismissalBowler": null, "dismissalFielder": "P007"},
    {"Match_ID": "M003", "Player_ID": "P001", "notOuts": 0, "runs": 30, "ballsFaced": 25, "fours": 3, "sixes": 1, "ballsBowled": 18, "runsConceded": 16, "wickets": 1, "extras": 0, "maidenOvers": 0, "isOut": true, "dismissalType": "caught", "dismissalBowler": "P003", "dismissalFielder": "P005"},
    {"Match_ID": "M003", "Player_ID": "P003", "notOuts": 1, "runs": 55, "ballsFaced": 38, "fours": 8, "sixes": 2, "ballsBowled": 24, "runsConceded": 28, "wickets": 3, "extras": 2, "maidenOvers": 1, "isOut": false, "dismissalType": null, "dismissalBowler": null, "dismissalFielder": null},
    {"Match_ID": "M003", "Player_ID": "P006", "notOuts": 0, "runs": 12, "ballsFaced": 8, "fours": 1, "sixes": 0, "ballsBowled": 12, "runsConceded": 14, "wickets": 0, "extras": 0, "maidenOvers": 0, "isOut": true, "dismissalType": "bowled", "dismissalBowler": "P003", "dismissalFielder": null}
  ]
};

// Data Aggregation Functions for Cricket Statistics
window.cricketStatsAggregator = {
  
  // Calculate player statistics from performance data
  calculatePlayerStats: function(playerData, performanceData) {
    const playerStats = {};
    
    playerData.forEach(player => {
      const playerId = player.Player_ID;
      const playerPerfs = performanceData.filter(p => p.Player_ID === playerId);
      
      // Batting Statistics
      const totalRuns = playerPerfs.reduce((sum, p) => sum + (p.runs || 0), 0);
      const totalBallsFaced = playerPerfs.reduce((sum, p) => sum + (p.ballsFaced || 0), 0);
      const totalFours = playerPerfs.reduce((sum, p) => sum + (p.fours || 0), 0);
      const totalSixes = playerPerfs.reduce((sum, p) => sum + (p.sixes || 0), 0);
      const totalNotOuts = playerPerfs.reduce((sum, p) => sum + (p.notOuts || 0), 0);
      const totalInnings = playerPerfs.length;
      const totalOuts = totalInnings - totalNotOuts;
      
      // Bowling Statistics
      const totalBallsBowled = playerPerfs.reduce((sum, p) => sum + (p.ballsBowled || 0), 0);
      const totalRunsConceded = playerPerfs.reduce((sum, p) => sum + (p.runsConceded || 0), 0);
      const totalWickets = playerPerfs.reduce((sum, p) => sum + (p.wickets || 0), 0);
      const totalMaidens = playerPerfs.reduce((sum, p) => sum + (p.maidenOvers || 0), 0);
      
      // Calculate derived statistics
      const battingAverage = totalOuts > 0 ? (totalRuns / totalOuts) : totalRuns;
      const strikeRate = totalBallsFaced > 0 ? (totalRuns / totalBallsFaced) * 100 : 0;
      const bowlingAverage = totalWickets > 0 ? (totalRunsConceded / totalWickets) : 0;
      const economy = totalBallsBowled > 0 ? (totalRunsConceded / (totalBallsBowled / 6)) : 0;
      const bowlingStrikeRate = totalWickets > 0 ? (totalBallsBowled / totalWickets) : 0;
      
      // Find best bowling figures
      let bestBowling = "0/0";
      let maxWickets = 0;
      let minRuns = 999;
      playerPerfs.forEach(p => {
        if (p.wickets > maxWickets || (p.wickets === maxWickets && p.runsConceded < minRuns)) {
          maxWickets = p.wickets;
          minRuns = p.runsConceded;
          bestBowling = `${p.wickets}/${p.runsConceded}`;
        }
      });
      
      // Find highest score
      const highestScore = Math.max(...playerPerfs.map(p => p.runs || 0));
      
      playerStats[playerId] = {
        // Basic Info
        playerId: playerId,
        name: player.Name,
        battingStyle: player.Batting_Style,
        bowlingStyle: player.Bowling_Style,
        isStar: player.Is_Star,
        
        // Batting Stats
        matches: totalInnings,
        innings: totalInnings,
        notOuts: totalNotOuts,
        runs: totalRuns,
        highestScore: highestScore,
        battingAverage: Math.round(battingAverage * 100) / 100,
        strikeRate: Math.round(strikeRate * 100) / 100,
        ballsFaced: totalBallsFaced,
        fours: totalFours,
        sixes: totalSixes,
        centuries: playerPerfs.filter(p => (p.runs || 0) >= 100).length,
        halfCenturies: playerPerfs.filter(p => (p.runs || 0) >= 50 && (p.runs || 0) < 100).length,
        ducks: playerPerfs.filter(p => (p.runs || 0) === 0 && p.isOut === true).length,
        
        // Bowling Stats
        bowlingMatches: playerPerfs.filter(p => (p.ballsBowled || 0) > 0).length,
        bowlingInnings: playerPerfs.filter(p => (p.ballsBowled || 0) > 0).length,
        ballsBowled: totalBallsBowled,
        runsConceded: totalRunsConceded,
        wickets: totalWickets,
        bestBowling: bestBowling,
        bowlingAverage: Math.round(bowlingAverage * 100) / 100,
        economy: Math.round(economy * 100) / 100,
        bowlingStrikeRate: Math.round(bowlingStrikeRate * 100) / 100,
        maidens: totalMaidens,
        fourWickets: playerPerfs.filter(p => (p.wickets || 0) >= 4).length,
        fiveWickets: playerPerfs.filter(p => (p.wickets || 0) >= 5).length
      };
    });
    
    return playerStats;
  },
  
  // Calculate team statistics
  calculateTeamStats: function(matchData) {
    const teamStats = {};
    
    matchData.forEach(match => {
      const teams = [match.Team1, match.Team2];
      
      teams.forEach(team => {
        if (!teamStats[team]) {
          teamStats[team] = {
            name: team,
            matches: 0,
            wins: 0,
            losses: 0,
            winPercentage: 0
          };
        }
        
        teamStats[team].matches++;
        
        if (match.Winning_Team === team) {
          teamStats[team].wins++;
        } else if (match.Losing_Team === team) {
          teamStats[team].losses++;
        }
      });
    });
    
    // Calculate win percentages
    Object.values(teamStats).forEach(team => {
      team.winPercentage = team.matches > 0 ? Math.round((team.wins / team.matches) * 100 * 100) / 100 : 0;
    });
    
    return teamStats;
  },
  
  // Get aggregated data ready for the app
  getAggregatedData: function() {
    const data = window.cricketStatsData;
    
    return {
      players: this.calculatePlayerStats(data.player_data, data.performance_data),
      matches: data.match_data,
      performance: data.performance_data,
      teams: this.calculateTeamStats(data.match_data),
      summary: {
        totalPlayers: data.player_data.length,
        totalMatches: data.match_data.length,
        totalPerformances: data.performance_data.length,
        starPlayers: data.player_data.filter(p => p.Is_Star).length
      }
    };
  }
};