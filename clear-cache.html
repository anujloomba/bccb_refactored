<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Clear Cache - Cricket PWA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 50px 20px;
            margin: 0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        .btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: scale(1.05);
            background: #e55a2b;
        }
        .steps {
            text-align: left;
            margin: 20px 0;
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 10px;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèè Cricket PWA Cache Clearer</h1>
        <p>This page will help you clear your browser cache and load the latest version of the Cricket PWA.</p>
        
        <div class="status" id="status">
            <strong>Ready to clear cache...</strong>
        </div>

        <div class="steps">
            <h3>Manual Chrome Cache Clear Steps:</h3>
            <ol>
                <li><strong>Press F12</strong> to open DevTools</li>
                <li><strong>Right-click the refresh button</strong> (while DevTools is open)</li>
                <li><strong>Select "Hard Reload"</strong> or "Empty Cache and Hard Reload"</li>
                <li>Or use <strong>Ctrl+Shift+R</strong> for hard refresh</li>
            </ol>
        </div>

        <button class="btn" onclick="clearServiceWorker()">üîß Clear Service Worker</button>
        <button class="btn" onclick="clearLocalStorage()">üíæ Clear Local Storage</button>
        <button class="btn" onclick="clearAll()">üßπ Clear Everything</button>
        <button class="btn" onclick="goToCricketApp()">üèè Go to Cricket App</button>
        
        <div class="steps" style="margin-top: 30px;">
            <h3>Debug Information:</h3>
            <button class="btn" onclick="showDebugInfo()" style="background: #2196F3;">üîç Show Debug Info</button>
            <div id="debugInfo" style="display: none; margin-top: 15px; font-size: 12px; text-align: left;"></div>
        </div>
    </div>

    <script>
        function updateStatus(message, color = '#4CAF50') {
            const status = document.getElementById('status');
            status.innerHTML = `<strong style="color: ${color}">${message}</strong>`;
            console.log('Status updated:', message);
        }

        async function clearServiceWorker() {
            try {
                updateStatus('üîÑ Clearing Service Worker...', '#ff9800');
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    console.log('Found registrations:', registrations.length);
                    for (const registration of registrations) {
                        await registration.unregister();
                        console.log('Unregistered:', registration.scope);
                    }
                    updateStatus('‚úÖ Service Worker cleared!');
                } else {
                    updateStatus('‚ÑπÔ∏è Service Worker not supported');
                }
            } catch (error) {
                console.error('Error clearing Service Worker:', error);
                updateStatus('‚ùå Error clearing Service Worker: ' + error.message, '#f44336');
            }
        }

        function clearLocalStorage() {
            try {
                updateStatus('üîÑ Clearing Local Storage...', '#ff9800');
                const localStorageKeys = Object.keys(localStorage);
                const sessionStorageKeys = Object.keys(sessionStorage);
                
                localStorage.clear();
                sessionStorage.clear();
                
                console.log('Cleared localStorage keys:', localStorageKeys);
                console.log('Cleared sessionStorage keys:', sessionStorageKeys);
                updateStatus('‚úÖ Local Storage cleared!');
            } catch (error) {
                console.error('Error clearing Local Storage:', error);
                updateStatus('‚ùå Error clearing Local Storage: ' + error.message, '#f44336');
            }
        }

        async function clearAll() {
            try {
                updateStatus('üîÑ Clearing everything...', '#ff9800');
                
                // Clear local storage
                localStorage.clear();
                sessionStorage.clear();
                console.log('Cleared storage');
                
                // Clear service worker
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (const registration of registrations) {
                        await registration.unregister();
                    }
                    console.log('Cleared service workers');
                }
                
                // Clear caches
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    console.log('Found caches:', cacheNames);
                    await Promise.all(
                        cacheNames.map(cacheName => caches.delete(cacheName))
                    );
                    console.log('Cleared all caches');
                }
                
                updateStatus('‚úÖ Everything cleared! Redirecting to app...');
                
                // Auto-redirect after 2 seconds
                setTimeout(() => {
                    window.location.href = '/?cleared=true&t=' + Date.now();
                }, 2000);
            } catch (error) {
                console.error('Error in clearAll:', error);
                updateStatus('‚ùå Error: ' + error.message, '#f44336');
            }
        }

        function goToCricketApp() {
            // Add timestamp to force fresh load
            const url = '/?t=' + Date.now() + '&cleared=true';
            console.log('Redirecting to:', url);
            window.location.href = url;
        }

        async function showDebugInfo() {
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.style.display = 'block';
            
            let info = '<strong>Browser Support:</strong><br>';
            info += `‚Ä¢ Service Worker: ${('serviceWorker' in navigator) ? '‚úÖ Yes' : '‚ùå No'}<br>`;
            info += `‚Ä¢ Cache API: ${('caches' in window) ? '‚úÖ Yes' : '‚ùå No'}<br>`;
            info += `‚Ä¢ Local Storage: ${(typeof Storage !== 'undefined') ? '‚úÖ Yes' : '‚ùå No'}<br>`;
            
            // Check service worker registrations
            if ('serviceWorker' in navigator) {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    info += `<br><strong>Service Workers (${registrations.length}):</strong><br>`;
                    registrations.forEach((reg, index) => {
                        info += `‚Ä¢ ${index + 1}: ${reg.scope}<br>`;
                    });
                } catch (error) {
                    info += `<br><strong>Service Workers:</strong> Error - ${error.message}<br>`;
                }
            }
            
            // Check caches
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    info += `<br><strong>Caches (${cacheNames.length}):</strong><br>`;
                    cacheNames.forEach((name, index) => {
                        info += `‚Ä¢ ${index + 1}: ${name}<br>`;
                    });
                } catch (error) {
                    info += `<br><strong>Caches:</strong> Error - ${error.message}<br>`;
                }
            }
            
            // Check local storage
            const localKeys = Object.keys(localStorage);
            const sessionKeys = Object.keys(sessionStorage);
            info += `<br><strong>Local Storage (${localKeys.length} items):</strong><br>`;
            localKeys.slice(0, 5).forEach(key => {
                info += `‚Ä¢ ${key}<br>`;
            });
            if (localKeys.length > 5) info += `‚Ä¢ ... and ${localKeys.length - 5} more<br>`;
            
            info += `<br><strong>Session Storage (${sessionKeys.length} items):</strong><br>`;
            sessionKeys.slice(0, 5).forEach(key => {
                info += `‚Ä¢ ${key}<br>`;
            });
            if (sessionKeys.length > 5) info += `‚Ä¢ ... and ${sessionKeys.length - 5} more<br>`;
            
            info += `<br><strong>Current URL:</strong> ${window.location.href}<br>`;
            info += `<strong>User Agent:</strong> ${navigator.userAgent}<br>`;
            
            debugDiv.innerHTML = info;
        }

        // Auto-clear on page load if requested
        if (window.location.search.includes('auto=true')) {
            console.log('Auto-clearing cache...');
            clearAll();
        }

        // Page load confirmation
        console.log('Clear cache page loaded successfully');
        updateStatus('‚úÖ Ready to clear cache...');
    </script>
</body>
</html>
